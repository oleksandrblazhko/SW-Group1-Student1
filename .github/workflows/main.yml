# This is a basic workflow to help you get started with Actions

name: PullRequestControl

# Controls when the workflow will run
on: [push]
jobs:
      my_checkout:
         # використовувати Docker-image із вказаною версією ОС
         runs-on: ubuntu-latest
         steps:
           - name: checkout
             # клонування репозиторія для подальшої роботи з файлами на сервері 
             # в каталозі $GITHUB_WORKSPACE
             uses: "actions/checkout@v3"
           - name: Print Workspace name and README.md
             run: |
              echo "Workspace:      $GITHUB_WORKSPACE"
              cat $GITHUB_WORKSPACE/README.md
      my_linter_test:
         runs-on: ubuntu-latest
         needs: [my_checkout]
         steps:
         - uses: actions/checkout@v3
         - uses: yu-iskw/action-sqlfluff@v3
           with:
            github_token: ${{ secrets.github_token }}
            reporter: github-pr-review
            sqlfluff_version: "1.2.0"
            sqlfluff_command: "fix" # Or "lint"
            config: "${{ github.workspace }}/.sqlfluff"
            paths: '${{ github.workspace }}/sql_query'
         - name: 'Show outputs (Optional)'
           shell: bash
           run: |
            echo '${{ steps.lint-sql.outputs.sqlfluff-results }}' | jq -r '.'
            echo '${{ steps.lint-sql.outputs.sqlfluff-results-rdjson }}' | jq -r '.'
           
